# ワタシノセカイト初音ミク インストールガイド

## 📋 目次
- [ワタシノセカイト初音ミク インストールガイド](#ワタシノセカイト初音ミク-インストールガイド)
  - [📋 目次](#-目次)
  - [1. 事前準備（全員必須）](#1-事前準備全員必須)
    - [1.1. CUDA ドライバーのインストール](#11-cuda-ドライバーのインストール)
      - [🔧 CUDA Toolkit 11.8 のインストール](#-cuda-toolkit-118-のインストール)
    - [1.2. VOICEVOX のセットアップ](#12-voicevox-のセットアップ)
      - [🎤 VOICEVOX のダウンロード](#-voicevox-のダウンロード)
    - [1.3. RVC のダウンロードとセットアップ](#13-rvc-のダウンロードとセットアップ)
      - [📥 RVC クライアントのダウンロード](#-rvc-クライアントのダウンロード)
      - [🎵 音声モデルのダウンロード](#-音声モデルのダウンロード)
      - [🔧 RVC の設定](#-rvc-の設定)
    - [1.4. OpenRouter APIキーの設定](#14-openrouter-apiキーの設定)
      - [🔑 OpenRouterアカウントの作成と設定](#-openrouterアカウントの作成と設定)
    - [1.5. Python 環境の準備](#15-python-環境の準備)
      - [🐍 Python 3.13 のインストール](#-python-313-のインストール)
      - [✅ インストール確認](#-インストール確認)
    - [1.6. Microsoft C++ Build Tools のインストール](#16-microsoft-c-build-tools-のインストール)
      - [🔧 Microsoft C++ Build Tools のインストール](#-microsoft-c-build-tools-のインストール)
  - [2. 簡単セットアップ（推奨）](#2-簡単セットアップ推奨)
    - [2.1. 対話型セットアップツールの実行](#21-対話型セットアップツールの実行)
      - [🚀 セットアップツールの起動](#-セットアップツールの起動)
    - [2.2. 自動設定の内容](#22-自動設定の内容)
      - [✅ 自動化される作業](#-自動化される作業)
  - [3. 手動セットアップ（上級者・トラブル時）](#3-手動セットアップ上級者トラブル時)
    - [3.1. 設定ファイルの手動作成](#31-設定ファイルの手動作成)
      - [📁 設定ファイルの準備](#-設定ファイルの準備)
      - [⚙️ system\_start.batの設定](#️-system_startbatの設定)
      - [🔑 settings.jsonの設定](#-settingsjsonの設定)
    - [3.2. 仮想環境の手動作成](#32-仮想環境の手動作成)
      - [📂 ディレクトリの移動](#-ディレクトリの移動)
      - [🔧 仮想環境の作成](#-仮想環境の作成)
    - [3.3. ライブラリの手動インストール](#33-ライブラリの手動インストール)
      - [🔄 仮想環境の有効化](#-仮想環境の有効化)
      - [📦 依存関係のインストール](#-依存関係のインストール)
  - [4. 起動・アクセス・終了方法](#4-起動アクセス終了方法)
    - [4.1. 起動方法](#41-起動方法)
      - [🚀 プログラムの起動](#-プログラムの起動)
    - [4.2. アクセス方法](#42-アクセス方法)
      - [🌐 起動したPCからのアクセス](#-起動したpcからのアクセス)
      - [📱 スマートフォンからのアクセス](#-スマートフォンからのアクセス)
      - [🌍 外部からのアクセス](#-外部からのアクセス)
    - [4.3. 終了方法](#43-終了方法)
  - [🎉 セットアップ完了！](#-セットアップ完了)

---

## 1. 事前準備（全員必須）

> ⏱️ **所要時間**: 約45分（ダウンロード時間を含む）
> 
> 📝 **注意**: 初心者・上級者問わず、以下の準備が必要です
>
> 📝 **フォルダ構成**: 配置後にフォルダの置き場所を変更すると、再設定が必要になります。`1. 事前準備（全員必須）`にてダウンロード・展開後、フォルダの置き場所を事前に決めてから`2. 簡単セットアップ（推奨）`または`3. 手動セットアップ（上級者・トラブル時）`に進んでください。

> 💡 **効率的なダウンロード方法**: 以下の6個のファイルはすべて同時にダウンロード可能です。先にすべてのダウンロードを開始してから、順次インストール・設定作業を行うと時間を短縮できます。詳細な手順は各セクションを参照してください。
>
> **同時ダウンロード可能対象一覧：**
> 
> 1.1 **CUDA Toolkit 11.8**
> 
> 1.2. **VOICEVOX（Windows用Zip版）**
> 
> 1.3. **RVC クライアント（Windows用cudaの最新ベータ版）**
> 
> 1.3. **音声モデル（初音ミク）**
> 
> 1.5. **Python 3.13**
> 
> 1.6. **Microsoft C++ Build Tools**

### 1.1. CUDA ドライバーのインストール

> 📝 **注意**: CUDA ドライバーが既にインストール済みの場合は、この手順をスキップしてください。
> ドライバーのバージョンが異なる場合は、3.3. [ライブラリの手動インストール]において、requirments2.txtを編集し、バージョンを変更してください。

#### 🔧 CUDA Toolkit 11.8 のインストール

1. 以下のリンクにアクセスしてください：
   ```
   https://developer.nvidia.com/cuda-11-8-0-download-archive
   ```

2. ダウンロードしてインストールしてください

---

### 1.2. VOICEVOX のセットアップ

#### 🎤 VOICEVOX のダウンロード

1. 公式サイトにアクセス：
   ```
   https://voicevox.hiroshiba.jp/
   ```

2. 「ダウンロード」をクリックし、以下を選択してダウンロード：
   - **OS**: Windows
   - **対応モード**: GPU/CPU
   - **形式**: Zip

3. ダウンロードしたファイルを展開し、任意のフォルダに配置

> 💡 **ヒント**: 後で対話型セットアップツールがパスを聞いてくるので、配置場所を覚えておいてください

---

### 1.3. RVC のダウンロードとセットアップ

#### 📥 RVC クライアントのダウンロード

1. 以下のリンクにアクセス：
   ```
   https://huggingface.co/wok000/vcclient000/tree/main
   ```

2. `vcclient_win_cuda_2.0.XX-beta.zip` をダウンロード（XXの部分は、現在最も数字が大きいものとしてください）

    >  **例**: vcclient_win_cuda_2.0.78-beta.zip

3. ダウンロードしたファイルを展開し、任意のフォルダに配置

#### 🎵 音声モデルのダウンロード

1. 以下のリンクから音声モデルをダウンロード：
   ```
   https://voice-models.com/model/1l4S8GaPGEY
   ```

2. 「Download Link」からファイルをダウンロードし、展開して任意のフォルダに配置

#### 🔧 RVC の設定

1. RVC フォルダ内の `dist\main\start_http.bat` をダブルクリックして起動
(初回起動時には必要なファイル等のダウンロードに少し時間がかかります。)

2. 起動した画面で以下の手順を実行：
   - モデルの「編集ボタン」をクリック
   - **[5]** と表示されている枠の「アップロード」を選択
   
   > ⚠️ **注意**: 必ず [5] を選択してください。他の番号を選択すると動作しません。

3. ダウンロードした音声モデル（infamousフォルダ内）のファイルを設定：
   - **Model**: `infamous_miku_v2.pth`
   - **Index**: `added_IVF2983_Flat_nprobe_1_infamous_miku_v2_v2.index`
   - 「アップロード」をクリック
   - 完了したら「閉じる」ボタンをクリック

4. 下部の設定を変更：
   - **画面上部青枠**: `infamous_...`を選択（必ずこれを一番先に実施すること）
   - **index**: `1`
   - **F0 Est**: `rmvpe`
   - **Chunk**: `48000[1 sec]`
   - **Extra**: `144000 [3 sec]`
   - **F0 Est**: `rmvpe`
   - **Gpu**: お使いのPCのGPUを選択

5. 他の設定は変更せずにRVCを閉じる

> 💡 **ヒント**: 後で対話型セットアップツールがパスを聞いてくるので、配置場所を覚えておいてください

---

### 1.4. OpenRouter APIキーの設定

#### 🔑 OpenRouterアカウントの作成と設定

1. 以下のリンクにアクセス：
   ```
   https://openrouter.ai/
   ```

2. 「Sign Up」からアカウントを作成

3. ダッシュボードの「API Keys」から新しいAPIキーを生成

4. 「Add Credits」から10ドル程度のクレジットを追加
   > 💡 **ヒント**: クレジットカードまたはPayPalなどで支払いが可能です

5. 生成したAPIキーをメモしておく
   > 💡 **ヒント**: 対話型セットアップツールで入力を求められます
   APIキーはあとから再表示できないため、必ずメモしてください
   メモしそこなった場合は、再度キーの発行が必要となります


---

### 1.5. Python 環境の準備

#### 🐍 Python 3.13 のインストール

> 📝 **注意**: Python 3.13系が既にインストール済みの場合は、この手順をスキップしてください。

1. 以下のリンクにアクセス：
   ```
   https://www.python.org/downloads/release/python-3133/
   ```

2. お使いのPCに適したインストーラーをダウンロード：
   - **64bit PC**: `Windows installer (64-bit)`

3. インストール時の重要な設定：
   - ✅ **ダウンロードしたインストーラーの実行時に、「Add python.exe to PATH」にチェックを入れてください**

#### ✅ インストール確認

コマンドプロンプトを開いて以下を実行：

```cmd
python --version
```
または
```cmd
python3.13 --version
```

`Python 3.13.X` と表示されることを確認してください。

---

### 1.6. Microsoft C++ Build Tools のインストール

> ⚠️ **重要**: Visual Studio がインストール済みの場合は、この手順をスキップできます

#### 🔧 Microsoft C++ Build Tools のインストール

1. 以下のリンクにアクセス：
   ```
   https://visualstudio.microsoft.com/visual-cpp-build-tools/
   ```

2. 「Build Tools」をダウンロードしてインストール

---

## 2. 簡単セットアップ（推奨）

> ⏱️ **所要時間**: 約15分
> 
> 🎯 **対象**: 初心者・手軽にセットアップしたい方

### 2.1. 対話型セットアップツールの実行

#### 🚀 セットアップツールの起動

1. `miku_agent-main\miku\setup_interactive.bat` をダブルクリックして実行

2. 画面の指示に従って以下を設定：
   - **RVCパス**: フォルダ選択ダイアログでRVCフォルダを選択
   - **VOICEVOXパス**: フォルダ選択ダイアログでVOICEVOXフォルダを選択
   - **OpenRouter APIキー**: 1.4で取得したAPIキーを入力

3. Python環境の構築とライブラリインストールが自動実行されます

4. 完了後、ショートカット作成の選択肢が表示されます

### 2.2. 自動設定の内容

#### ✅ 自動化される作業

- **設定ファイルの作成**: `system_start.bat` と `settings.json`
- **APIキーの設定**: OpenRouter APIキーの自動書き込み
- **パス設定**: 各ソフトウェアのパス自動設定
- **Python仮想環境**: 自動作成と有効化
- **ライブラリインストール**: 必要なパッケージの自動インストール
- **ショートカット作成**: `Start_HatsuneMiku_System.lnk` の作成（オプション）


---

## 3. 手動セットアップ（上級者・トラブル時）

> ⏱️ **所要時間**: 約30分
> 
> 🎯 **対象**: 上級者・対話型ツールでエラーが発生した場合

### 3.1. 設定ファイルの手動作成

#### 📁 設定ファイルの準備

以下のサンプルファイルをコピーして、ファイル名を変更（「_sample」の削除）してください：

| 元ファイル                | コピーしたファイル名 | ファイルの存在する場所      |
| ------------------------- | -------------------- | --------------------------- |
| `system_start_sample.bat` | `system_start.bat`   | `miku_agent-main\miku\`     |
| `settings_sample.json`    | `settings.json`      | `miku_agent-main\miku\src\` |

#### ⚙️ system_start.batの設定

`system_start.bat` を開いて以下のパスを設定：

- `RVC_PATH`: RVCを配置したフォルダのフルパス
- `VOICEVOX_PATH`: VOICEVOXを配置したフォルダのフルパス  
- `MIKU_PATH`: miku_agent-mainフォルダのフルパス

#### 🔑 settings.jsonの設定

`settings.json` を開いて以下を設定：

- `api.openrouter.api_key`: 1.4で取得したOpenRouter APIキー

### 3.2. 仮想環境の手動作成

#### 📂 ディレクトリの移動

1. コマンドプロンプトを開く
2. `miku_agent-main\miku` ディレクトリに移動

**移動コマンド例**:
```cmd
cd C:sample\miku_agent-main\miku
```

#### 🔧 仮想環境の作成

以下のコマンドを実行：

```cmd
python -m venv venv
```
または
```cmd
python3.13 -m venv venv
```

> ⚠️ **重要**: 環境名は必ず `venv` にしてください。他の名前にすると動作しません。

### 3.3. ライブラリの手動インストール

#### 🔄 仮想環境の有効化

`miku_agent-main\miku` ディレクトリで以下を実行：

```cmd
venv\Scripts\activate
```

コマンドプロンプトの左に `(venv)` と表示されることを確認してください。

#### 📦 依存関係のインストール

1. `miku_agent-main\miku\src` ディレクトリに移動：
   ```cmd
   cd src
   ```

2. 必要なライブラリをインストール（2段階で実施）：
```cmd
   REM 1. 一般的なパッケージをインストール
   pip install -r requirements.txt

   REM 2. PyTorchパッケージ（CUDA対応版）をインストール
   pip install -r requirements2.txt
   ```

---

## 4. 起動・アクセス・終了方法

### 4.1. 起動方法

#### 🚀 プログラムの起動

`miku_agent-main\miku\system_start.bat` をダブルクリックして起動します。

> 💡 **ヒント**: 
> - 初回セットアップ後は、この手順のみでプログラムを起動できます
> - 対話型セットアップでショートカットを作成した場合は、`Start_HatsuneMiku_System.lnk` をデスクトップ等に配置し、ダブルクリックすることでも起動できます

---

### 4.2. アクセス方法

#### 🌐 起動したPCからのアクセス

ブラウザを開いて以下のURLにアクセス：
```
http://localhost:5001
```

#### 📱 スマートフォンからのアクセス

1. PCにてコマンドプロンプトで以下を実行してIPアドレスを確認：
```cmd
   ipconfig
   ```

2. 表示されたIPアドレスをスマートフォンのブラウザのURLに入力してアクセス：
   ```
   http://192.168.0.10:5001
   ```
   （IPアドレスは例です。実際の値に置き換えてください。ポートは5001で固定です。）

#### 🌍 外部からのアクセス

**WireGuard** などのVPNを使用することで、外出先からもスマートフォンなどにてアクセス可能です。

> ⚠️ **注意**: PCがスリープモードにならないよう、事前に電源設定を変更してください。

---

### 4.3. 終了方法

プログラムを終了する際は、以下をすべて閉じてください：

- ✅ `system_start.bat` で起動したコマンドプロンプト
- ✅ VOICEVOX
- ✅ RVC のGUIとコマンドプロンプト両方のタブ

---

## 🎉 セットアップ完了！

お疲れ様でした！これで`ワタシノセカイト初音ミク`の準備が完了しました。

2回目以降の起動の際は`miku_agent-main\miku\system_start.bat`のダブルクリックのみでOKです。

2回目の起動時にも追加ダウンロードが必要となるため少し時間がかかりますが、3回目以降はダウンロードはなくなります。

3回目以降にも、初音ミクの記憶の整理のため、起動にも少し時間がかかります。一番初めに起動するコマンドプロンプトに以下の表示がされると、起動完了です。

```
 * Serving Flask app 'app'
 * Debug mode: off
INFO:werkzeug:WARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:5001
 * Running on http://192.168.0.10:5001
INFO:werkzeug:Press CTRL+C to quit
```


何か問題が発生した場合は、各手順を再確認するか、エラーメッセージを確認してトラブルシューティングを行ってください。

XのDMでも受け付けますが、回答に少し時間がかかる場合があります。